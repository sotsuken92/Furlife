<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒ©ãƒ³ã‚­ãƒ³ã‚°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="/static/css/common.css">
  <link rel="stylesheet" href="/static/css/ranking.css">
  <!-- PWAç”¨ãƒ¡ã‚¿ã‚¿ã‚° -->
  <meta name="theme-color" content="#3182ce">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Furlife">
  <link rel="manifest" href="/static/manifest.json">
  <link rel="apple-touch-icon" href="/static/images/icon-192.png">
  <!-- ãƒ¢ãƒã‚¤ãƒ«UIæ‹¡å¼µ -->
  <link rel="stylesheet" href="/static/css/mobile-enhancements.css">
</head>

<body>
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="header">
    <div class="header-left">
      <div class="logo">ğŸ¾ Furlife</div>
      <nav class="nav-links">
        <a href="/" class="nav-link">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</a>
        <a href="/pet" class="nav-link">ãƒšãƒƒãƒˆè©³ç´°</a>
        <a href="/shop" class="nav-link">ã‚·ãƒ§ãƒƒãƒ—</a>
        <a href="/ranking" class="nav-link active">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</a>
        
        <!-- è¨­å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
        <div class="settings-wrapper">
          <div class="settings-trigger">è¨­å®š â–¾</div>
          <div class="settings-menu">
            <!-- ãƒ†ãƒ¼ãƒè¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="settings-section">
              <div class="settings-section-header">
                <span>ãƒ†ãƒ¼ãƒã‚’é¸æŠ</span>
                <span class="settings-arrow">â–¼</span>
              </div>
              <div class="settings-section-content">
                <!-- ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒ -->
                <div class="theme-category-title">ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰</div>
                <div class="theme-grid">
                  <div class="theme-color-box red" data-theme="red-light"></div>
                  <div class="theme-color-box orange" data-theme="orange-light"></div>
                  <div class="theme-color-box yellow" data-theme="yellow-light"></div>
                  <div class="theme-color-box green" data-theme="green-light"></div>
                  <div class="theme-color-box blue" data-theme="blue-light"></div>
                  <div class="theme-color-box purple" data-theme="purple-light"></div>
                </div>
                
                <!-- ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒ -->
                <div class="theme-category-title">ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</div>
                <div class="theme-grid">
                  <div class="theme-color-box red-dark" data-theme="red-dark"></div>
                  <div class="theme-color-box orange-dark" data-theme="orange-dark"></div>
                  <div class="theme-color-box yellow-dark" data-theme="yellow-dark"></div>
                  <div class="theme-color-box green-dark" data-theme="green-dark"></div>
                  <div class="theme-color-box blue-dark" data-theme="blue-dark"></div>
                  <div class="theme-color-box purple-dark" data-theme="purple-dark"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </div>
    <div class="header-right">
      <span class="coin-info"><img src="/static/images/coin/coin.jpg"> <span id="header-coin-count">{{ pet.coins }}</span></span>
      <span class="user-info">{{ username }}ã•ã‚“</span>
      <a href="/logout" class="btn-logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
    </div>
  </header>

  <div class="container">
    <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
    <div class="ranking-title">
      <h1>ã€€ ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h1>
    </div>

    <!-- è‡ªåˆ†ã®é †ä½ã‚«ãƒ¼ãƒ‰ -->
    <div class="my-rank-card">
      <h2 class="card-title">ã€€ ã‚ãªãŸã®é †ä½</h2>
      <div class="my-rank-grid">
        <div class="my-rank-item">
          <div class="rank-label">ç·ç²å¾—â˜…æ•°éƒ¨é–€</div>
          <div class="rank-value">
            <span class="rank-number">{{ current_user_stars_rank if current_user_stars_rank else '-' }}</span>
            <span class="rank-suffix">ä½</span>
          </div>
          <div class="rank-detail">
            {% if current_user_data %}
              {% set huge_stars = current_user_data.total_stars // 10 %}
              {% set big_stars = (current_user_data.total_stars % 10) // 5 %}
              {% set small_stars = current_user_data.total_stars % 5 %}
              {% for i in range(huge_stars) %}<span class="huge-star">ğŸŒŸ</span>{% endfor %}{% for i in range(big_stars) %}<span class="big-star">â­</span>{% endfor %}{% for i in range(small_stars) %}<span class="small-star">â˜…</span>{% endfor %}
              <span class="star-count-white">({{ current_user_data.total_stars }})</span>
            {% else %}
              0
            {% endif %}
          </div>
        </div>
        
        <div class="my-rank-item">
          <div class="rank-label">ç·ç²å¾—â˜…æ•°éƒ¨é–€</div>
          <div class="rank-value">
            <span class="rank-number">{{ current_user_stars_rank if current_user_stars_rank else '-' }}</span>
            <span class="rank-suffix">ä½</span>
          </div>
          <div class="rank-detail">{% for i in range(current_user_data.total_stars if current_user_data else 0) %}â˜…{% endfor %}</div>
        </div>
      </div>
    </div>

    <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ« -->
    <div class="ranking-grid">
      <!-- å›³é‘‘ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆéƒ¨é–€ -->
      <div class="ranking-card">
        <h2 class="card-title">ã€€ å›³é‘‘ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆéƒ¨é–€</h2>
        <div class="ranking-subtitle">ç™ºè¦‹ã—ãŸãƒšãƒƒãƒˆã®æ•°</div>
        
        <div class="ranking-table">
          <div class="ranking-header">
            <div class="rank-col">é †ä½</div>
            <div class="user-col">ãƒ¦ãƒ¼ã‚¶ãƒ¼</div>
            <div class="score-col">ç™ºè¦‹æ•°</div>
          </div>
          
          {% for user in top10_discovery %}
          <div class="ranking-row {% if user.username == username %}highlight{% endif %}">
            <div class="rank-col">
              {% if loop.index == 1 %}
                <span class="medal gold">ğŸ¥‡</span>
              {% elif loop.index == 2 %}
                <span class="medal silver">ğŸ¥ˆ</span>
              {% elif loop.index == 3 %}
                <span class="medal bronze">ğŸ¥‰</span>
              {% else %}
                <span class="rank-text">{{ loop.index }}</span>
              {% endif %}
            </div>
            <div class="user-col">
              <span class="username">{{ user.username }}</span>
              {% if user.username == username %}
                <span class="badge-you">YOU</span>
              {% endif %}
            </div>
            <div class="score-col">
              <span class="score-value">{{ user.discovery_count }}</span>
              <span class="score-max">/ 70</span>
            </div>
          </div>
          {% endfor %}
          
          {% if top10_discovery|length == 0 %}
          <div class="ranking-empty">
            ã¾ã ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“
          </div>
          {% endif %}
        </div>
      </div>

      <!-- ç·ç²å¾—â˜…æ•°éƒ¨é–€ -->
      <div class="ranking-card">
        <h2 class="card-title">ã€€ ç·ç²å¾—â˜…æ•°éƒ¨é–€</h2>
        <div class="ranking-subtitle">ãƒ¬ã‚¢ãƒšãƒƒãƒˆã®ç²å¾—æ•°</div>
        
        <div class="ranking-table">
          <div class="ranking-header">
            <div class="rank-col">é †ä½</div>
            <div class="user-col">ãƒ¦ãƒ¼ã‚¶ãƒ¼</div>
            <div class="score-col">â˜…æ•°</div>
          </div>
          
          {% for user in top10_stars %}
          <div class="ranking-row {% if user.username == username %}highlight{% endif %}">
            <div class="rank-col">
              {% if loop.index == 1 %}
                <span class="medal gold">ğŸ¥‡</span>
              {% elif loop.index == 2 %}
                <span class="medal silver">ğŸ¥ˆ</span>
              {% elif loop.index == 3 %}
                <span class="medal bronze">ğŸ¥‰</span>
              {% else %}
                <span class="rank-text">{{ loop.index }}</span>
              {% endif %}
            </div>
            <div class="user-col">
              <span class="username">{{ user.username }}</span>
              {% if user.username == username %}
                <span class="badge-you">YOU</span>
              {% endif %}
            </div>
            <div class="score-col">
              <span class="stars">
                {% set huge_stars = user.total_stars // 10 %}
                {% set big_stars = (user.total_stars % 10) // 5 %}
                {% set small_stars = user.total_stars % 5 %}
                {% for i in range(huge_stars) %}<span class="huge-star">ğŸŒŸ</span>{% endfor %}{% for i in range(big_stars) %}<span class="big-star">â­</span>{% endfor %}{% for i in range(small_stars) %}<span class="small-star">â˜…</span>{% endfor %}
              </span>
              <span class="star-count">({{ user.total_stars }})</span>
            </div>
          </div>
          {% endfor %}
          
          {% if top10_stars|length == 0 %}
          <div class="ranking-empty">
            ã¾ã ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
    <div class="back-button-container">
      <a href="/pet" class="btn btn-light">â† ãƒšãƒƒãƒˆè©³ç´°ã«æˆ»ã‚‹</a>
    </div>
  </div>

  <script src="/static/js/ranking.js"></script>
  <script src="/static/js/mobile-ui.js"></script>

  <script>
  // Service Workerç™»éŒ²
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/static/js/service-worker.js')
        .then((registration) => {
          console.log('Service Workerç™»éŒ²æˆåŠŸ:', registration.scope);
        })
        .catch((error) => {
          console.log('Service Workerç™»éŒ²å¤±æ•—:', error);
        });
    });
  }
  </script>
</body>
</html>