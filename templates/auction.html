<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³å¸‚å ´</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="/static/css/common.css">
  <link rel="stylesheet" href="/static/css/auction.css">
  <!-- PWAç”¨ãƒ¡ã‚¿ã‚¿ã‚° -->
  <meta name="theme-color" content="#3182ce">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Furlife">
  <link rel="manifest" href="/static/manifest.json">
  <link rel="apple-touch-icon" href="/static/images/icon-192.png">
  <!-- ãƒ¢ãƒã‚¤ãƒ«UIæ‹¡å¼µ -->
  <link rel="stylesheet" href="/static/css/mobile-enhancements.css">
</head>

<body>
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="header">
    <div class="header-left">
      <div class="logo">ğŸ¾ Furlife</div>
      <nav class="nav-links">
        <a href="/" class="nav-link">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</a>
        <a href="/pet" class="nav-link">ãƒšãƒƒãƒˆè©³ç´°</a>
        <a href="/shop" class="nav-link">ã‚·ãƒ§ãƒƒãƒ—</a>
        <a href="/auction" class="nav-link active">ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³</a>
        <a href="/ranking" class="nav-link">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</a>
        
        <!-- è¨­å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
        <div class="settings-wrapper">
          <div class="settings-trigger">è¨­å®š â–¾</div>
          <div class="settings-menu">
            <div class="settings-section">
              <div class="settings-section-header">
                <span>ãƒ†ãƒ¼ãƒã‚’é¸æŠ</span>
                <span class="settings-arrow">â–¼</span>
              </div>
              <div class="settings-section-content">
                <div class="theme-category-title">ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰</div>
                <div class="theme-grid">
                  <div class="theme-color-box red" data-theme="red-light"></div>
                  <div class="theme-color-box orange" data-theme="orange-light"></div>
                  <div class="theme-color-box yellow" data-theme="yellow-light"></div>
                  <div class="theme-color-box green" data-theme="green-light"></div>
                  <div class="theme-color-box blue" data-theme="blue-light"></div>
                  <div class="theme-color-box purple" data-theme="purple-light"></div>
                </div>
                
                <div class="theme-category-title">ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</div>
                <div class="theme-grid">
                  <div class="theme-color-box red-dark" data-theme="red-dark"></div>
                  <div class="theme-color-box orange-dark" data-theme="orange-dark"></div>
                  <div class="theme-color-box yellow-dark" data-theme="yellow-dark"></div>
                  <div class="theme-color-box green-dark" data-theme="green-dark"></div>
                  <div class="theme-color-box blue-dark" data-theme="blue-dark"></div>
                  <div class="theme-color-box purple-dark" data-theme="purple-dark"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </div>
    <div class="header-right">
      <span class="coin-info"><img src="/static/images/coin/coin.jpg"> <span id="header-coin-count">{{ pet.coins }}</span></span>
      <span class="user-info">{{ username }}ã•ã‚“</span>
      <a href="/logout" class="btn-logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
    </div>
  </header>

  <div class="container">
    <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
    <div class="auction-title">
      <h1>ğŸ›ï¸ ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³å¸‚å ´</h1>
      <p class="subtitle">ãƒšãƒƒãƒˆã‚’å‡ºå“ãƒ»å…¥æœ­ã—ã¦ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ‹¡å¤§ã—ã‚ˆã†ï¼</p>
    </div>

    <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="auction-tabs">
      <button class="tab-btn active" data-tab="all">å…¨ã¦ã®ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³</button>
      <button class="tab-btn" data-tab="my-listings">è‡ªåˆ†ã®å‡ºå“</button>
      <button class="tab-btn" data-tab="my-bids">å…¥æœ­ä¸­</button>
      <button class="tab-btn" data-tab="create">æ–°è¦å‡ºå“</button>
    </div>

    <!-- å…¨ã¦ã®ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="tab-content active" id="tab-all">
      <div class="filter-bar">
        <div class="filter-group">
          <label>ä¸¦ã³æ›¿ãˆ:</label>
          <select id="sort-select">
            <option value="ending-soon">çµ‚äº†ãŒè¿‘ã„é †</option>
            <option value="price-low">ä¾¡æ ¼ãŒå®‰ã„é †</option>
            <option value="price-high">ä¾¡æ ¼ãŒé«˜ã„é †</option>
            <option value="rarity-high">ãƒ¬ã‚¢åº¦ãŒé«˜ã„é †</option>
          </select>
        </div>
        <div class="filter-group">
          <label>ãƒ¬ã‚¢åº¦:</label>
          <select id="rarity-filter">
            <option value="all">å…¨ã¦</option>
            <option value="5">â˜…â˜…â˜…â˜…â˜…</option>
            <option value="4">â˜…â˜…â˜…â˜…</option>
            <option value="3">â˜…â˜…â˜…</option>
            <option value="2">â˜…â˜…</option>
            <option value="1">â˜…</option>
          </select>
        </div>
      </div>

      <div class="auction-grid" id="auction-list">
        {% if auctions|length == 0 %}
        <div class="empty-state">
          <div class="empty-icon">ğŸº</div>
          <p>ç¾åœ¨ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ã¯ã‚ã‚Šã¾ã›ã‚“</p>
          <p class="empty-subtitle">è‡ªåˆ†ã®ãƒšãƒƒãƒˆã‚’å‡ºå“ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼</p>
        </div>
        {% else %}
          {% for auction in auctions %}
          <div class="auction-card" data-rarity="{{ auction.rarity }}" data-price="{{ auction.current_price }}" data-time="{{ auction.time_remaining.total_seconds }}">
            <div class="auction-header">
              <div class="seller-info">
                <span class="seller-icon">ğŸ‘¤</span>
                <span class="seller-name">{{ auction.seller }}</span>
              </div>
              <div class="rarity-badge rarity-{{ auction.rarity }}">
                {% for i in range(auction.rarity) %}â˜…{% endfor %}
              </div>
            </div>

            <div class="pet-display">
              <img src="/static/images/{{ auction.image }}" alt="ãƒšãƒƒãƒˆ" class="pet-image">
              <div class="pet-stats">
                <div class="stat-item">
                  <span class="stat-label">Lv.</span>
                  <span class="stat-value">{{ auction.pet_data.level }}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">ã‚¿ã‚¤ãƒ—</span>
                  <span class="stat-value">{{ auction.pet_data.pet_type }}</span>
                </div>
                {% if auction.pet_data.level >= 30 %}
                <div class="stat-item">
                  <span class="stat-label">é€²åŒ–</span>
                  <span class="stat-value">{{ auction.pet_data.evolution }}</span>
                </div>
                {% endif %}
              </div>
            </div>

            <div class="auction-info">
              <div class="price-section">
                <div class="price-label">ç¾åœ¨ã®ä¾¡æ ¼</div>
                <div class="price-amount">
                  <img src="/static/images/coin/coin.jpg" class="coin-icon">
                  <span class="price-value">{{ auction.current_price }}</span>
                </div>
                <div class="bid-count">{{ auction.bid_count }}ä»¶ã®å…¥æœ­</div>
              </div>

              <div class="time-section">
                <div class="time-label">æ®‹ã‚Šæ™‚é–“</div>
                <div class="countdown" data-end-seconds="{{ auction.time_remaining.total_seconds }}">
                  {% if auction.time_remaining.days > 0 %}
                    <span class="time-part"><span class="time-num">{{ auction.time_remaining.days }}</span>æ—¥</span>
                  {% endif %}
                  <span class="time-part"><span class="time-num">{{ auction.time_remaining.hours }}</span>æ™‚é–“</span>
                  <span class="time-part"><span class="time-num">{{ auction.time_remaining.minutes }}</span>åˆ†</span>
                </div>
              </div>
            </div>

            <div class="auction-actions">
              {% if auction.is_own %}
                <button class="btn-secondary" disabled>è‡ªåˆ†ã®å‡ºå“</button>
                {% if auction.bid_count == 0 %}
                <button class="btn-cancel" data-auction-id="{{ auction.id }}">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                {% endif %}
              {% else %}
                {% if auction.is_highest_bidder %}
                  <button class="btn-success" disabled>æœ€é«˜å…¥æœ­è€…</button>
                {% else %}
                  <button class="btn-primary btn-bid" data-auction-id="{{ auction.id }}" data-current-price="{{ auction.current_price }}">å…¥æœ­ã™ã‚‹</button>
                {% endif %}
              {% endif %}
            </div>
          </div>
          {% endfor %}
        {% endif %}
      </div>
    </div>

    <!-- è‡ªåˆ†ã®å‡ºå“ -->
    <div class="tab-content" id="tab-my-listings">
      <div class="auction-grid">
        {% if my_auctions|length == 0 %}
        <div class="empty-state">
          <div class="empty-icon">ğŸ“¦</div>
          <p>å‡ºå“ä¸­ã®ãƒšãƒƒãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p>
        </div>
        {% else %}
          {% for auction in my_auctions %}
          <!-- ä¸Šè¨˜ã¨åŒæ§˜ã®ã‚«ãƒ¼ãƒ‰è¡¨ç¤º -->
          <div class="auction-card">
            <!-- çœç•¥ -->
          </div>
          {% endfor %}
        {% endif %}
      </div>
    </div>

    <!-- å…¥æœ­ä¸­ -->
    <div class="tab-content" id="tab-my-bids">
      <div class="auction-grid">
        {% if my_bidding_auctions|length == 0 %}
        <div class="empty-state">
          <div class="empty-icon">ğŸ”¨</div>
          <p>å…¥æœ­ä¸­ã®ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ã¯ã‚ã‚Šã¾ã›ã‚“</p>
        </div>
        {% else %}
          {% for auction in my_bidding_auctions %}
          <!-- ä¸Šè¨˜ã¨åŒæ§˜ã®ã‚«ãƒ¼ãƒ‰è¡¨ç¤º -->
          <div class="auction-card">
            <!-- çœç•¥ -->
          </div>
          {% endfor %}
        {% endif %}
      </div>
    </div>

    <!-- æ–°è¦å‡ºå“ -->
    <div class="tab-content" id="tab-create">
      <div class="create-auction-card">
        <h2>ãƒšãƒƒãƒˆã‚’å‡ºå“ã™ã‚‹</h2>
        
        <div class="current-pet-display">
          <h3>ç¾åœ¨ã®ãƒšãƒƒãƒˆ</h3>
          {% if pet.alive and pet.started %}
          <div class="pet-preview">
            <img src="/static/images/{{ image }}" alt="ãƒšãƒƒãƒˆ" class="preview-image">
            <div class="preview-stats">
              <p><strong>ãƒ¬ãƒ™ãƒ«:</strong> {{ pet.level }}</p>
              <p><strong>ã‚¿ã‚¤ãƒ—:</strong> {{ pet.pet_type }}</p>
              <p><strong>çµŒé¨“å€¤:</strong> {{ pet.exp }}</p>
              {% if pet.level >= 30 %}
              <p><strong>é€²åŒ–ã‚¿ã‚¤ãƒ—:</strong> {{ pet.evolution }}</p>
              {% endif %}
            </div>
          </div>
          {% else %}
          <div class="no-pet-warning">
            <p>âš ï¸ å‡ºå“ã§ãã‚‹ãƒšãƒƒãƒˆãŒã„ã¾ã›ã‚“</p>
            <p>åµã‹ã‚‰ãƒšãƒƒãƒˆã‚’è‚²ã¦ã¾ã—ã‚‡ã†ï¼</p>
          </div>
          {% endif %}
        </div>

        {% if pet.alive and pet.started %}
        <div class="create-form">
          <div class="form-group">
            <label>é–‹å§‹ä¾¡æ ¼ï¼ˆã‚³ã‚¤ãƒ³ï¼‰</label>
            <input type="number" id="starting-price" min="1" value="100" class="form-input">
            <p class="form-hint">æ‰‹æ•°æ–™: <span id="fee-display">5</span>ã‚³ã‚¤ãƒ³ (5%)</p>
          </div>

          <div class="form-group">
            <label>ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³æœŸé–“</label>
            <div class="duration-options">
              <label class="duration-option">
                <input type="radio" name="duration" value="24h" checked>
                <span>24æ™‚é–“</span>
              </label>
              <label class="duration-option">
                <input type="radio" name="duration" value="48h">
                <span>48æ™‚é–“</span>
              </label>
              <label class="duration-option">
                <input type="radio" name="duration" value="72h">
                <span>72æ™‚é–“</span>
              </label>
            </div>
          </div>

          <div class="warning-box">
            <p>âš ï¸ å‡ºå“ã™ã‚‹ã¨ç¾åœ¨ã®ãƒšãƒƒãƒˆã¯åµã«æˆ»ã‚Šã¾ã™</p>
            <p>âš ï¸ æ‰‹æ•°æ–™ã¯è¿”é‡‘ã•ã‚Œã¾ã›ã‚“</p>
          </div>

          <button class="btn-primary btn-create-auction" id="btn-create-auction">å‡ºå“ã™ã‚‹</button>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- å…¥æœ­ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal" id="bid-modal">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>å…¥æœ­ã™ã‚‹</h3>
        <button class="modal-close" id="close-bid-modal">âœ•</button>
      </div>
      <div class="modal-body">
        <p>ç¾åœ¨ã®ä¾¡æ ¼: <strong><span id="modal-current-price">0</span>ã‚³ã‚¤ãƒ³</strong></p>
        <p>ã‚ãªãŸã®æ‰€æŒã‚³ã‚¤ãƒ³: <strong><span id="modal-user-coins">{{ pet.coins }}</span>ã‚³ã‚¤ãƒ³</strong></p>
        
        <div class="form-group">
          <label>å…¥æœ­é¡ï¼ˆã‚³ã‚¤ãƒ³ï¼‰</label>
          <input type="number" id="bid-amount" class="form-input" min="1">
          <p class="form-hint">ç¾åœ¨ã®ä¾¡æ ¼ã‚ˆã‚Šé«˜ã„é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
        </div>

        <div class="quick-bid-buttons">
          <button class="btn-quick-bid" data-add="10">+10</button>
          <button class="btn-quick-bid" data-add="50">+50</button>
          <button class="btn-quick-bid" data-add="100">+100</button>
          <button class="btn-quick-bid" data-add="500">+500</button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" id="cancel-bid">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn-primary" id="confirm-bid">å…¥æœ­</button>
      </div>
    </div>
  </div>

  <script src="/static/js/auction.js"></script>
  <script src="/static/js/mobile-ui.js"></script>

  <script>
  // Service Workerç™»éŒ²
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/static/js/service-worker.js')
        .then((registration) => {
          console.log('Service Workerç™»éŒ²æˆåŠŸ:', registration.scope);
        })
        .catch((error) => {
          console.log('Service Workerç™»éŒ²å¤±æ•—:', error);
        });
    });
  }
  </script>
</body>
</html>