<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒšãƒƒãƒˆè©³ç´°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="/static/css/common.css">
  <link rel="stylesheet" href="/static/css/pet_detail.css">
  <link rel="stylesheet" href="/static/css/levelup-modal.css">
  <!-- PWAç”¨ãƒ¡ã‚¿ã‚¿ã‚° -->
  <meta name="theme-color" content="#3182ce">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Furlife">
  <link rel="manifest" href="/static/manifest.json">
  <link rel="apple-touch-icon" href="/static/images/icon-192.png">
  <!-- ãƒ¢ãƒã‚¤ãƒ«UIæ‹¡å¼µ -->
  <link rel="stylesheet" href="/static/css/mobile-enhancements.css">
</head>




<body>
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="header">
    <div class="header-left">
      <div class="logo"> Furlife</div>
      <nav class="nav-links">
        <a href="/" class="nav-link">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</a>
        <a href="/pet" class="nav-link">ãƒšãƒƒãƒˆè©³ç´°</a>
        <a href="/shop" class="nav-link">ã‚·ãƒ§ãƒƒãƒ—</a>
        <div class="settings-wrapper">
          <div class="settings-trigger">è¨­å®š â–¾</div>
          <div class="settings-menu">


            <!-- ãƒ†ãƒ¼ãƒè¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="settings-section">
              <div class="settings-section-header">
                <span>ãƒ†ãƒ¼ãƒã‚’é¸æŠ</span>
                <span class="settings-arrow">â–¼</span>
              </div>
              <div class="settings-section-content">
                <!-- ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒ -->
                <div class="theme-category-title">ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰</div>
                <div class="theme-grid">
                  <div class="theme-color-box red" data-theme="red-light"></div>
                  <div class="theme-color-box orange" data-theme="orange-light"></div>
                  <div class="theme-color-box yellow" data-theme="yellow-light"></div>
                  <div class="theme-color-box green" data-theme="green-light"></div>
                  <div class="theme-color-box blue" data-theme="blue-light"></div>
                  <div class="theme-color-box purple" data-theme="purple-light"></div>
                </div>
                
                <!-- ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒ -->
                <div class="theme-category-title">ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</div>
                <div class="theme-grid">
                  <div class="theme-color-box red-dark" data-theme="red-dark"></div>
                  <div class="theme-color-box orange-dark" data-theme="orange-dark"></div>
                  <div class="theme-color-box yellow-dark" data-theme="yellow-dark"></div>
                  <div class="theme-color-box green-dark" data-theme="green-dark"></div>
                  <div class="theme-color-box blue-dark" data-theme="blue-dark"></div>
                  <div class="theme-color-box purple-dark" data-theme="purple-dark"></div>
                </div>
              </div>
            </div>
      </nav>
    </div>
    <div class="header-right">
      <span class="coin-info">ğŸ’° <span id="header-coin-count">{{ pet.coins }}</span></span>
      <span class="user-info">{{ username }}ã•ã‚“</span>
      <a href="/logout" class="btn-logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
    </div>
  </header>

  <div class="container">
    <div class="main-grid">
      
      <!-- å·¦å´: ãƒšãƒƒãƒˆè©³ç´° -->
      <div class="card">
        <h1 class="card-title"> ãƒšãƒƒãƒˆè©³ç´°</h1>

        <div id="pet-name-display" class="pet-name-display">åå‰æœªè¨­å®š</div>

        <img id="pet-img-large" src="/static/images/{{ image }}" alt="ãƒšãƒƒãƒˆã®ç”»åƒ" class="pet-image-large" />

        <!-- çµŒé¨“å€¤ãƒãƒ¼ -->
        {% if pet.alive and pet.started %}
        <div class="exp-bar-container">
          <div class="exp-bar-label">
            <span>çµŒé¨“å€¤</span>
            <span id="exp-display">{{ pet.exp }} / {{ exp_table[pet.level] if pet.level in exp_table else 0 }}</span>
          </div>
          <div class="exp-bar-bg">
            <div id="exp-bar-fill" class="exp-bar-fill" style="width: {% if pet.level in exp_table and exp_table[pet.level] > 0 %}{{ (pet.exp / exp_table[pet.level] * 100) | round }}{% else %}0{% endif %}%;"></div>
          </div>
        </div>
        {% endif %}

        <div class="pet-message-box">
          <p id="pet-message">{{ pet.message }}</p>
        </div>

        <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ« -->
        <div class="status-table">
          <div class="status-row">
            <span class="status-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</span>
            <span class="status-value">
              {% if pet.alive %}
                <span class="badge-success">âœ“ å…ƒæ°—</span>
              {% else %}
                <span class="badge-danger">âœ— æ­»äº¡</span>
              {% endif %}
            </span>
          </div>

          {% if pet.alive or pet.started %}
          <div class="status-row">
            <span class="status-label">ãƒ¬ãƒ™ãƒ«</span>
            <span class="status-value">
              <span class="level-badge">Lv.{{ pet.level }}</span>
              {% if (pet.pet_type == 1 and pet.level == 10) or (pet.pet_type != 1 and pet.level == 5) %}
                <span class="evolution-badge">ã‚¿ã‚¤ãƒ—{{ pet.evolution }}</span>
              {% endif %}
            </span>
          </div>
          {% endif %}
          <!-- æ‰€æŒã—ã¦ã„ã‚‹é¤Œ -->
          
          <div class="status-row inventory-row">
            <span class="status-label">æ‰€æŒé¤Œ</span>
            <span class="status-value inventory-compact">
              <span class="compact-food-item selectable" data-food="åŸºæœ¬ã®é¤Œ" data-exp="1">
                <img src="/static/images/food/åŸºæœ¬ã®é¤Œ.jpg" alt="åŸºæœ¬ã®é¤Œ" class="food-emoji">
                <span class="food-count" id="inventory-basic">{{ pet.inventory.get('åŸºæœ¬ã®é¤Œ', 0) }}</span>
                <span class="food-name-mini">â˜…</span>
              </span>
              <span class="compact-food-item selectable" data-food="ãŠã„ã—ã„é¤Œ" data-exp="6">
                <img src="/static/images/food/ãŠã„ã—ã„é¤Œ.jpg" alt="ãŠã„ã—ã„é¤Œ" class="food-emoji">
                <span class="food-count" id="inventory-tasty">{{ pet.inventory.get('ãŠã„ã—ã„é¤Œ', 0) }}</span>
                <span class="food-name-mini">â˜…â˜…</span>
              </span>
              <span class="compact-food-item selectable" data-food="ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é¤Œ" data-exp="14">
                <img src="/static/images/food/ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é¤Œ.jpg" alt="ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é¤Œ" class="food-emoji">
                <span class="food-count" id="inventory-premium">{{ pet.inventory.get('ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é¤Œ', 0) }}</span>
                <span class="food-name-mini">â˜…â˜…â˜…</span>
              </span>
              <span class="compact-food-item selectable" data-food="ã‚¹ãƒšã‚·ãƒ£ãƒ«é¤Œ" data-exp="32">
                <img src="/static/images/food/ã‚¹ãƒšã‚·ãƒ£ãƒ«é¤Œ.jpg" alt="ã‚¹ãƒšã‚·ãƒ£ãƒ«é¤Œ" class="food-emoji">
                <span class="food-count" id="inventory-basic">{{ pet.inventory.get('ã‚¹ãƒšã‚·ãƒ£ãƒ«é¤Œ', 0) }}</span>
                <span class="food-name-mini">â˜…â˜…â˜…â˜…</span>
              </span>
            </span>
          </div>
          
        </div>

        <!-- é¤Œã‚„ã‚Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <button class="selected-food-display" id="selectedFoodDisplay">
          <img src="/static/images/food/åŸºæœ¬ã®é¤Œ.jpg" alt="åŸºæœ¬ã®é¤Œ" id="selectedEmoji" class="selected-emoji">
          <div class="selected-info">
            <span class="selected-name" id="selectedName">åŸºæœ¬ã®é¤Œ</span>
            <span class="selected-exp" id="selectedExp">+1 EXP</span>
          </div>
        </button>
        

        <!-- ãƒœã‚¿ãƒ³ -->
        {% if not pet.started %}
          <button id="start-btn" class="btn btn-primary">è‚²æˆé–‹å§‹</button>
        {% elif not pet.alive %}
          <button id="revive-btn" class="btn btn-warning">åµã‹ã‚‰è‚²ã¦ç›´ã™</button>
        {% else %}
          <button id="revive-btn-alive" class="btn btn-warning">è‚²ã¦ç›´ã™</button>
        {% endif %}

        <a href="/" style="text-decoration: none;">
          <button class="btn btn-light">â† ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«æˆ»ã‚‹</button>
        </a>
      </div>

      <!-- å³å´: å›³é‘‘ -->
      <div class="card pokedex-card">
        <h2 class="card-title"> ãƒšãƒƒãƒˆå›³é‘‘</h2>
        
        <div class="text-center">
          <span class="completion-badge">
            ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆ: <span id="completion-count">{{ all_pets | selectattr('discovered') | list | length }}</span> / 70
          </span>
        </div>

        <!-- å›³é‘‘ã‚»ã‚¯ã‚·ãƒ§ãƒ³(ç³»çµ±ã”ã¨) -->
        <div class="pokedex-sections">
          {% set ns = namespace(counter=0) %}
          {% for type_id in range(1, 7) %}
            <div class="pokedex-section">
              <h3 class="pokedex-section-title">{{ pet_types[type_id].name }}</h3>
              <div class="pokedex-grid">
                {% for pet_data in all_pets %}
                  {% if pet_data.pet_type == type_id %}
                    {% set ns.counter = ns.counter + 1 %}
                    <div class="pokedex-item {% if pet_data.discovered %}discovered{% else %}locked{% endif %}" 
                        data-image="{{ pet_data.image }}"
                        data-name="{{ pet_data.name }}"
                        data-discovered="{{ pet_data.discovered }}"
                        data-è‚²æˆ-count="{{ pet_data.è‚²æˆ_count }}"
                        data-rarity="{{ pet_data.rarity }}">
                      
                      <div class="pokedex-number">No.{{ ns.counter }}</div>
                      
                      <!-- ãƒ¬ã‚¢ãƒªãƒ†ã‚£æ˜Ÿè¡¨ç¤º -->
                      {% if pet_data.discovered and pet_data.rarity %}
                        <div class="pokedex-rarity">
                          {% for i in range(pet_data.rarity) %}
                            <span class="rarity-star">â˜…</span>
                          {% endfor %}
                        </div>
                      {% endif %}
                      
                      {% if pet_data.discovered %}
                        <img src="/static/images/{{ pet_data.image }}" alt="{{ pet_data.name }}" class="pokedex-img" loading="lazy">
                        <div class="pokedex-name">{{ pet_data.name }}</div>
                        <div class="pokedex-è‚²æˆ-count">è‚²æˆå›æ•°: {{ pet_data.è‚²æˆ_count }}å›</div>
                      {% else %}
                        <div class="question-mark">?</div>
                        <div class="pokedex-name">???</div>
                        <div class="pokedex-è‚²æˆ-count">è‚²æˆå›æ•°: -</div>
                      {% endif %}
                      
                    </div>
                  {% endif %}
                {% endfor %}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
      
    </div>
  </div>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  
  <!-- ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="levelup-modal" id="levelupModal">
    <div class="levelup-backdrop"></div>
    <div class="levelup-content" id="levelupContent">
      <div class="levelup-sparkles" id="levelupSparkles"></div>
      <div class="levelup-title">LEVEL UP!</div>
      <div class="levelup-level-change">
        <span class="level-from" id="levelupLevelFrom">Lv.0</span>
        <span class="level-arrow">â†’</span>
        <span class="level-to" id="levelupLevelTo">Lv.1</span>
      </div>
      <div class="levelup-pet-container">
        <div class="levelup-pet-glow"></div>
        <img id="levelupPetImage" src="" alt="ãƒšãƒƒãƒˆ" class="levelup-pet-image">
      </div>
      <div class="levelup-message" id="levelupMessage">ãŠã‚ã§ã¨ã†!</div>
      <div class="levelup-evolution-type" id="levelupEvolutionType" style="display: none;">ã‚¿ã‚¤ãƒ—1ã«é€²åŒ–!</div>
      <div class="levelup-rarity" id="levelupRarity" style="display: none;"></div>
      <button class="levelup-close-btn" id="levelupCloseBtn">å›³é‘‘ã§ç¢ºèªã™ã‚‹</button>
    </div>
  </div>

  <!-- ãƒšãƒƒãƒˆè©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="pet-detail-modal" id="petDetailModal">
    <div class="pet-detail-backdrop"></div>
    <div class="pet-detail-content">
      <button class="pet-detail-close" id="closePetDetailBtn">âœ•</button>
      <img id="modalPetImage" src="" alt="ãƒšãƒƒãƒˆ" class="modal-pet-image">
      <div id="modalPetRarity" class="modal-pet-rarity"></div>
      <h2 id="modalPetName" class="modal-pet-name"></h2>
      <div id="modalPetType" class="modal-pet-type"></div>
      <p id="modalPetDescription" class="modal-pet-description"></p>
      <div id="modalPetè‚²æˆCount" class="modal-pet-è‚²æˆ-count"></div>
      <div id="modalPetNumber" class="modal-pet-number"></div>
    </div>
  </div>

  <!-- ãƒšãƒƒãƒˆé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="pet-select-modal" id="petSelectModal">
    <div class="pet-select-content">
      <h2 class="pet-select-title">è‚²ã¦ã‚‹ãƒšãƒƒãƒˆã‚’é¸ã‚“ã§ãã ã•ã„</h2>
      <div class="pet-select-grid">
        {% for type_id, type_info in pet_types.items() %}
          <div class="pet-select-item" data-pet-type="{{ type_id }}">
            <img src="/static/images/pet{{ type_id }}/egg.jpg" alt="{{ type_info.name }}" class="pet-select-image">
            <div class="pet-select-name">{{ type_info.name }}</div>
            <div class="pet-select-desc">{{ type_info.description }}</div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <script src="/static/js/pet_detail.js"></script>

  <script>
  // Service Workerç™»éŒ²
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/static/js/service-worker.js')
        .then((registration) => {
          console.log('Service Workerç™»éŒ²æˆåŠŸ:', registration.scope);
        })
        .catch((error) => {
          console.log('Service Workerç™»éŒ²å¤±æ•—:', error);
        });
    });
  }
  </script>
  <script src="/static/js/pet_detail.js"></script>
  <script src="/static/js/mobile-ui.js"></script>

</body>
</html>