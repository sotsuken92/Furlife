<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="/static/css/common.css">
  <link rel="stylesheet" href="/static/css/calendar.css">
  <link rel="stylesheet" href="/static/css/levelup-modal.css">
  <!-- PWAç”¨ãƒ¡ã‚¿ã‚¿ã‚° -->
  <meta name="theme-color" content="#3182ce">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Furlife">
  <link rel="manifest" href="/static/manifest.json">
  <link rel="apple-touch-icon" href="/static/images/icon-192.png">
  <!-- ãƒ¢ãƒã‚¤ãƒ«UIæ‹¡å¼µ -->
  <link rel="stylesheet" href="/static/css/mobile-enhancements.css">
</head>



<body>
  <!-- ========================================================================
      ãƒ˜ãƒƒãƒ€ãƒ¼
      ======================================================================== -->
  <header class="header">
    <div class="header-left">
      <div class="logo"> Furlife</div>
      <nav class="nav-links">
        <a href="/" class="nav-link">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</a>
        <a href="/pet" class="nav-link">ãƒšãƒƒãƒˆè©³ç´°</a>
        <a href="/shop" class="nav-link">ã‚·ãƒ§ãƒƒãƒ—</a>
        <a href="/ranking" class="nav-link">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</a>
        
        <!-- è¨­å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
        <div class="settings-wrapper">
          <div class="settings-trigger">è¨­å®š â–¾</div>
          <div class="settings-menu">
            
            <!-- ãƒ†ãƒ¼ãƒè¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="settings-section">
              <div class="settings-section-header">
                <span>ãƒ†ãƒ¼ãƒã‚’é¸æŠ</span>
                <span class="settings-arrow">â–¼</span>
              </div>
              <div class="settings-section-content">
                <!-- ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒ -->
                <div class="theme-category-title">ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰</div>
                <div class="theme-grid">
                  <div class="theme-color-box red" data-theme="red-light"></div>
                  <div class="theme-color-box orange" data-theme="orange-light"></div>
                  <div class="theme-color-box yellow" data-theme="yellow-light"></div>
                  <div class="theme-color-box green" data-theme="green-light"></div>
                  <div class="theme-color-box blue" data-theme="blue-light"></div>
                  <div class="theme-color-box purple" data-theme="purple-light"></div>
                </div>
                
                <!-- ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒ -->
                <div class="theme-category-title">ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</div>
                <div class="theme-grid">
                  <div class="theme-color-box red-dark" data-theme="red-dark"></div>
                  <div class="theme-color-box orange-dark" data-theme="orange-dark"></div>
                  <div class="theme-color-box yellow-dark" data-theme="yellow-dark"></div>
                  <div class="theme-color-box green-dark" data-theme="green-dark"></div>
                  <div class="theme-color-box blue-dark" data-theme="blue-dark"></div>
                  <div class="theme-color-box purple-dark" data-theme="purple-dark"></div>
                </div>
              </div>
            </div>

            <!-- æ™‚é–“é–“éš”è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="settings-section">
              <div class="settings-section-header">
                <span>äºˆå®šã®æ™‚é–“é–“éš”</span>
                <span class="settings-arrow">â–¼</span>
              </div>
              <div class="settings-section-content">
                <div class="time-duration-options">
                  <div class="time-duration-option" data-duration="30">
                    <input type="radio" name="time-duration" id="duration-30" value="30">
                    <label for="duration-30">30åˆ†</label>
                  </div>
                  <div class="time-duration-option" data-duration="60">
                    <input type="radio" name="time-duration" id="duration-60" value="60" checked>
                    <label for="duration-60">1æ™‚é–“</label>
                  </div>
                  <div class="time-duration-option" data-duration="90">
                    <input type="radio" name="time-duration" id="duration-90" value="90">
                    <label for="duration-90">1æ™‚é–“30åˆ†</label>
                  </div>
                  <div class="time-duration-option" data-duration="120">
                    <input type="radio" name="time-duration" id="duration-120" value="120">
                    <label for="duration-120">2æ™‚é–“</label>
                  </div>
                </div>
              </div>
            </div>

            <!-- å ´æ‰€ã®è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="settings-section">
              <div class="settings-section-header">
                <span>å ´æ‰€ã®è¨­å®š</span>
                <span class="settings-arrow">â–¼</span>
              </div>
              <div class="settings-section-content">
                <div id="settings-location-list" class="settings-location-list"></div>
                <div style="padding: 12px 16px;">
                  <button class="btn-add-location" id="settings-add-location-btn">+ æ–°ã—ã„å ´æ‰€</button>
                </div>
              </div>
            </div>

            <!-- ãƒ©ãƒ³ãƒ€ãƒ äºˆå®šã®è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="settings-section">
              <div class="settings-section-header">
                <span>ãƒ©ãƒ³ãƒ€ãƒ äºˆå®šã®è¨­å®š</span>
                <span class="settings-arrow">â–¼</span>
              </div>
              <div class="settings-section-content">
                <div id="settings-event-list" class="settings-event-list"></div>
                <div style="padding: 12px 16px;">
                  <button class="btn-add-event-preset" id="settings-add-event-btn">+ æ–°ã—ã„äºˆå®š</button>
                </div>
              </div>
            </div>
            
          </div>
        </div>
      </nav>
    </div>
    <div class="header-right">
      <span class="coin-info"><img src="/static/images/coin/coin.jpg"> <span id="header-coin-count">{{ pet.coins }}</span></span>
      <span class="user-info">{{ username }}ã•ã‚“</span>
      <a href="/logout" class="btn-logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
    </div>
  </header>

  <div class="container">
    <!-- ========================================================================
        ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«
        ======================================================================== -->
    <div class="calendar-title">
      <h1>{{ year }}å¹´{{ month }}æœˆ</h1>
    </div>

    <!-- ========================================================================
        ç›®æ¨™ã‚»ã‚¯ã‚·ãƒ§ãƒ³
        ======================================================================== -->
    <div class="goal-card">
      <div class="card-title"> ä»Šæœˆã®ç›®æ¨™</div>
      
      <!-- ç›®æ¨™è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
      <div id="goal-display-area" {% if current_goal.goal %}style="display:block"{% else %}style="display:none"{% endif %}>
        <div class="goal-text" id="goal-text">{{ current_goal.goal if current_goal.goal else '' }}</div>
        {% if current_goal.achieved %}
          <span class="badge badge-success">âœ“ é”æˆæ¸ˆã¿</span>
        {% elif current_goal.goal %}
          <button class="btn btn-warning btn-small" id="achieve-goal-btn">é”æˆ</button>
        {% endif %}
      </div>
      
      <!-- ç›®æ¨™å…¥åŠ›ã‚¨ãƒªã‚¢ -->
      <div id="goal-input-area" {% if current_goal.goal %}style="display:none"{% else %}style="display:block"{% endif %}>
        <div class="goal-input-group">
          <input type="text" id="goal-input" class="goal-input" placeholder="ä»Šæœˆã®ç›®æ¨™ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" maxlength="100">
          <button class="btn btn-primary" id="set-goal-btn">è¨­å®š</button>
        </div>
      </div>
    </div>

    <!-- ========================================================================
        ãƒ¡ã‚¤ãƒ³ã‚°ãƒªãƒƒãƒ‰(ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ + ãƒšãƒƒãƒˆã‚«ãƒ¼ãƒ‰)
        ======================================================================== -->
    <div class="main-grid">
      
      <!-- ä»Šæ—¥ã®äºˆå®š(ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å½¢å¼) -->
      <div class="card">
        <h2 class="card-title">
          <span id="selected-date-label">ä»Šæ—¥ã®äºˆå®š</span>
          <button id="date-picker-trigger" class="date-picker-trigger">æ—¥ä»˜å¤‰æ›´ â–¾</button>
          <button id="add-event-trigger" class="add-event-trigger">+ äºˆå®šè¿½åŠ </button>
          <input type="hidden" id="selected-date-input" value="{{ today }}">
        </h2>
        
        <div class="timeline-container">
          <div class="timeline-scroll">
            <div class="timeline-grid">
              
              <!-- æ™‚é–“è»¸ -->
              <div class="timeline-hours">
                {% for hour in range(24) %}
                  <div class="hour-label">{{ "%02d"|format(hour) }}:00</div>
                {% endfor %}
              </div>
              
              <!-- ã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
              <div class="timeline-events" id="timeline-events">
                {% if today_events %}
                  {% for ev in today_events %}
                    {% set start_time = ev.get('start_time', ev.get('time', '00:00')) %}
                    {% set end_time = ev.get('end_time', '23:59') %}
                    
                    {# ğŸ”§ ä¿®æ­£: å½“æ—¥ã‹ã¤çµ‚äº†æ™‚åˆ»ãŒéããŸäºˆå®š #}
                    {% set is_past = (end_time <= now_time) %}
                    
                    {# ğŸ”§ ä¿®æ­£: å‰Šé™¤å¯èƒ½æ¡ä»¶ - æœªæ¥ã®äºˆå®šã§æœªåˆ¤å®šã®ã‚‚ã® #}
                    {% set can_delete = (not is_past and ev.done is none) %}
                    
                    {% set start_parts = start_time.split(':') %}
                    {% set end_parts = end_time.split(':') %}
                    {% set start_minutes = start_parts[0]|int * 60 + start_parts[1]|int %}
                    {% set end_minutes = end_parts[0]|int * 60 + end_parts[1]|int %}
                    {% set top_position = (start_minutes / 1440.0 * 100) %}
                    {% set height = ((end_minutes - start_minutes) / 1440.0 * 100) %}
                    
                    {% set event_class = "timeline-event" %}
                    {% if ev.done == true %}
                      {% set event_class = event_class + " event-done" %}
                    {% elif ev.done == false %}
                      {% set event_class = event_class + " event-failed" %}
                    {% elif is_past %}
                      {% set event_class = event_class + " event-past" %}
                    {% endif %}
                    
                    <div class="{{ event_class }}" 
                        style="top: {{ top_position }}%; height: {{ height }}%;" 
                        data-id="{{ ev.id }}" 
                        data-date="{{ today }}" 
                        data-start-time="{{ start_time }}" 
                        data-end-time="{{ end_time }}" 
                        data-event="{{ ev.event }}" 
                        data-location="{{ ev.get('location', 'ãã®ä»–') }}">
                      <div class="timeline-event-time">{{ start_time }} - {{ end_time }}</div>
                      <div class="timeline-event-location">ğŸ“ {{ ev.get('location', 'ãã®ä»–') }}</div>
                      <div class="timeline-event-text">{{ ev.event }}</div>
                      <div class="timeline-event-actions">
                        {# ğŸ”§ ä¿®æ­£: éå»ã®äºˆå®šã§æœªåˆ¤å®šã®ã‚‚ã®ã¯å¸¸ã«ãƒœã‚¿ãƒ³è¡¨ç¤º #}
                        {% if is_past and ev.done is none %}
                          <button class="btn btn-success btn-small done-btn" data-id="{{ ev.id }}" data-date="{{ today }}" data-done="true">ã§ããŸ</button>
                          <button class="btn btn-danger btn-small done-btn" data-id="{{ ev.id }}" data-date="{{ today }}" data-done="false">ã§ããªã‹ã£ãŸ</button>
                        {% elif ev.done is not none %}
                          {% if ev.done %}
                            <span class="badge badge-success">âœ“ ã§ããŸ</span>
                          {% else %}
                            <span class="badge badge-danger">âœ— ã§ããªã‹ã£ãŸ</span>
                          {% endif %}
                        {% endif %}
                        
                        {# ğŸ”§ ä¿®æ­£: æœªæ¥ã®äºˆå®šã¾ãŸã¯åˆ¤å®šæ¸ˆã¿ã®äºˆå®šã®ã¿å‰Šé™¤å¯èƒ½ #}
                        {% if can_delete or ev.done is not none %}
                          <button class="btn btn-danger btn-small delete-btn" data-id="{{ ev.id }}" data-date="{{ today }}">å‰Šé™¤</button>
                        {% endif %}
                      </div>
                    </div>
                  {% endfor %}
                {% endif %}
                
                <!-- ç¾åœ¨æ™‚åˆ»ã®ãƒ©ã‚¤ãƒ³ -->
                {% set now_parts = now_time.split(':') %}
                {% set now_minutes = now_parts[0]|int * 60 + now_parts[1]|int %}
                {% set now_position = (now_minutes / 1440.0 * 100) %}
                <div class="current-time-line" style="top: {{ now_position }}%;">
                  <div class="current-time-marker"></div>
                  <div class="current-time-label">{{ now_time }}</div>
                </div>
              </div>
              
            </div>
          </div>
        </div>
      </div>

      <!-- ãƒšãƒƒãƒˆã‚«ãƒ¼ãƒ‰ -->
      <div class="pet-card">
        <div id="level-label" class="pet-level" {% if image == 'egg.jpg' or not pet.alive %}style="display:none"{% else %}style="display:block"{% endif %}>
          Lv.{{ pet.level }}
        </div>
        <input type="text" id="pet-name-input" class="pet-name-input" placeholder="åå‰ã‚’å…¥åŠ›" maxlength="10">
        <img id="pet-img" src="/static/images/{{ image }}" alt="ãƒšãƒƒãƒˆ" class="pet-image" onclick="location.href='/pet'">
        
        <!-- çµŒé¨“å€¤ãƒãƒ¼(ç”Ÿå­˜ä¸­ã®ã¿è¡¨ç¤º) -->
        <div class="exp-bar-container" {% if not (pet.alive and pet.started) %}style="display: none;"{% endif %}>
          <div class="exp-bar-label">
            <span>çµŒé¨“å€¤</span>
            <span id="exp-display">{{ pet.exp }} / {{ exp_table[pet.level] if pet.level in exp_table else 0 }}</span>
          </div>
          <div class="exp-bar-bg">
            <div id="exp-bar-fill" class="exp-bar-fill" style="width: {% if pet.level in exp_table and exp_table[pet.level] > 0 %}{{ (pet.exp / exp_table[pet.level] * 100) | round }}{% else %}0{% endif %}%;"></div>
          </div>
        </div>
        
        <p id="pet-message" class="pet-message">{{ pet.message }}</p>

        <!-- è‚²æˆé–‹å§‹ã‚¨ãƒªã‚¢ -->
        <div id="start-area" class="{% if pet.started %}hidden{% endif %}">
          <button id="start" class="pet-btn">è‚²ã¦ã‚‹</button>
        </div>

        <!-- ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ -->
        <div id="game-area" class="{% if not pet.started %}hidden{% endif %}">
          <div id="coin-display" class="coin-display"> ã‚³ã‚¤ãƒ³: <span id="coin-count">{{ pet.coins }}</span></div>
          <button id="go-to-shop-btn" class="pet-btn pet-btn-shop"> ã‚·ãƒ§ãƒƒãƒ—ã«è¡Œã</button>
          <button id="revive-btn-game" class="pet-btn">è‚²ã¦ç›´ã™</button>
          <div id="revive-area" class="hidden" style="margin-top: 8px;">
            <button id="revive" class="pet-btn">åµã‹ã‚‰è‚²ã¦ç›´ã™</button>
          </div>
        </div>
      </div>
      
    </div>

    <!-- ========================================================================
        ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
        ======================================================================== -->
    <div class="calendar-wrapper">
      <div class="calendar-header">
        <div class="calendar-month-display">{{ year }}å¹´{{ month }}æœˆ</div>
        <div class="calendar-nav">
          <a href="{{ prev_link }}" class="btn btn-primary">â† å‰æœˆ</a>
          <a href="{{ next_link }}" class="btn btn-primary">ç¿Œæœˆ â†’</a>
        </div>
      </div>

      <table class="calendar-table">
        <thead>
          <tr>
            {% for w in weeknames %}
              <th>{{ w }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for cols in weeks %}
            <tr>
              {% for d in cols %}
                {% set date_str = "{:04}-{:02}-{:02}".format(year, month, d) if d != 0 else "" %}
                <td class="calendar-cell {% if date_str == today %}today{% endif %}" data-date="{{ date_str }}">
                  {% if d != 0 %}
                    <div class="day-number">{{ d }}</div>
                    {% for item in events.get(date_str, []) %}
                      {% set item_start = item.get('start_time', item.get('time', '00:00')) %}
                      {% set item_end = item.get('end_time', '23:59') %}
                      {% set item_location = item.get('location', 'ãã®ä»–') %}
                      <div class="calendar-event event-entry" 
                          data-id="{{ item.id }}" 
                          data-start-time="{{ item_start }}" 
                          data-end-time="{{ item_end }}" 
                          data-event="{{ item.event }}" 
                          data-date="{{ date_str }}" 
                          data-location="{{ item_location }}">
                        {{ item_start }}-{{ item_end }} {{ item.event }}
                      </div>
                    {% endfor %}
                  {% endif %}
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- ========================================================================
        ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ 
        ======================================================================== -->
    <div id="form" class="form-card hidden">
      <h3 class="card-title">äºˆå®šã®ç·¨é›†</h3>
      <form id="eventForm" method="post">
        <div id="form-error-message" class="alert" style="display: none;"></div>
        <input type="hidden" name="date" id="date" />
        <input type="hidden" name="id" id="event_id" />

        <div class="form-group">
          <label class="form-label">å ´æ‰€</label>
          <select name="location" id="locationSelect" class="form-select" required>
            <option value="">å ´æ‰€ã‚’é¸æŠ</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">é–‹å§‹æ™‚é–“</label>
          <input type="time" name="start_time" id="startTimeInput" class="form-input" required />
        </div>

        <div class="form-group">
          <label class="form-label">çµ‚äº†æ™‚é–“</label>
          <input type="time" name="end_time" id="endTimeInput" class="form-input" required />
        </div>

        <div class="form-group">
          <label class="form-label">äºˆå®š</label>
          <div class="event-input-wrapper">
            <input type="text" name="event" id="eventInput" class="form-input event-input-field" required />
            <button type="button" id="randomEventBtn" class="btn-random-event" title="ãƒ©ãƒ³ãƒ€ãƒ ãªäºˆå®šã‚’å…¥åŠ›">ğŸ²</button>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" id="cancelBtn" class="btn" style="background: var(--text-tertiary); color: white;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button type="submit" id="submitBtn" class="btn btn-primary">ä¿å­˜</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ==========================================================================
      ãƒ¢ãƒ¼ãƒ€ãƒ«
      ========================================================================== -->
  
  <!-- ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="levelup-modal" id="levelupModal">
    <div class="levelup-backdrop"></div>
    <div class="levelup-content" id="levelupContent">
      
      <!-- ã‚­ãƒ©ã‚­ãƒ©ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ -->
      <div class="levelup-sparkles" id="levelupSparkles"></div>
      
      <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
      <div class="levelup-title">LEVEL UP!</div>
      
      <!-- ãƒ¬ãƒ™ãƒ«å¤‰åŒ– -->
      <div class="levelup-level-change">
        <span class="level-from" id="levelupLevelFrom">Lv.0</span>
        <span class="level-arrow">â†’</span>
        <span class="level-to" id="levelupLevelTo">Lv.1</span>
      </div>
      
      <!-- ãƒšãƒƒãƒˆç”»åƒ -->
      <div class="levelup-pet-container">
        <div class="levelup-pet-glow"></div>
        <img id="levelupPetImage" src="" alt="ãƒšãƒƒãƒˆ" class="levelup-pet-image">
      </div>
      
      <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
      <div class="levelup-message" id="levelupMessage">
        ãŠã‚ã§ã¨ã†!
      </div>
      
      <!-- é€²åŒ–ã‚¿ã‚¤ãƒ—ãƒãƒƒã‚¸(æœ€çµ‚é€²åŒ–æ™‚ã®ã¿è¡¨ç¤º) -->
      <div class="levelup-evolution-type" id="levelupEvolutionType" style="display: none;">
        ã‚¿ã‚¤ãƒ—1ã«é€²åŒ–!
      </div>
      
      <!-- ãƒ¬ã‚¢ãƒªãƒ†ã‚£æ˜Ÿ(æœ€çµ‚é€²åŒ–æ™‚ã®ã¿è¡¨ç¤º) -->
      <div class="levelup-rarity" id="levelupRarity" style="display: none;">
      </div>
      
      <!-- é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ -->
      <button class="levelup-close-btn" id="levelupCloseBtn">
        å›³é‘‘ã§ç¢ºèªã™ã‚‹
      </button>
    </div>
  </div>

  <!-- ã‚³ã‚¤ãƒ³ç²å¾—ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="coin-modal" id="coinModal">
    <div class="coin-backdrop"></div>
    <div class="coin-content">
      
      <!-- ã‚­ãƒ©ã‚­ãƒ©ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ -->
      <div class="coin-sparkles" id="coinSparkles"></div>
      
      <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
      <div class="coin-title">COIN GET!</div>
      
      <!-- ã‚³ã‚¤ãƒ³ã‚¢ã‚¤ã‚³ãƒ³ -->
      <div class="coin-icon-container">
        <div class="coin-icon-glow"></div>
        <div class="coin-icon"><img src="/static/images/coin/coin.jpg"></div>
      </div>
      
      <!-- ç²å¾—ã‚³ã‚¤ãƒ³æ•° -->
      <div class="coin-amount" id="coinAmount">+100</div>
      
      <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
      <div class="coin-message" id="coinMessage">
        ã‚ˆãã§ãã¾ã—ãŸ!
      </div>
      
      <!-- åˆè¨ˆã‚³ã‚¤ãƒ³ -->
      <div class="coin-total">
        æ‰€æŒã‚³ã‚¤ãƒ³: <span class="coin-total-amount" id="coinTotalAmount">1000</span>
      </div>
      
      <!-- é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ -->
      <button class="coin-close-btn" id="coinCloseBtn">
        OK
      </button>
    </div>
  </div>

  <!-- ãƒšãƒƒãƒˆé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="pet-select-modal" id="petSelectModal">
    <div class="pet-select-content">
      <h2 class="pet-select-title">è‚²ã¦ã‚‹ãƒšãƒƒãƒˆã‚’é¸ã‚“ã§ãã ã•ã„</h2>
      <div class="pet-select-grid">
        {% for type_id, type_info in pet_types.items() %}
          <div class="pet-select-item" data-pet-type="{{ type_id }}">
            <img src="/static/images/pet{{ type_id }}/egg.jpg" alt="{{ type_info.name }}" class="pet-select-image">
            <div class="pet-select-name">{{ type_info.name }}</div>
            <div class="pet-select-desc">{{ type_info.description }}</div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="color-picker-modal" id="colorPickerModal">
    <div class="color-picker-content">
      <h3 class="color-picker-title">è‰²ã‚’é¸æŠ</h3>
      <div class="color-presets" id="colorPresets">
        <div class="color-preset" data-color="#ef4444" style="background: #ef4444;"></div>
        <div class="color-preset" data-color="#f97316" style="background: #f97316;"></div>
        <div class="color-preset" data-color="#f59e0b" style="background: #f59e0b;"></div>
        <div class="color-preset" data-color="#eab308" style="background: #eab308;"></div>
        <div class="color-preset" data-color="#84cc16" style="background: #84cc16;"></div>
        <div class="color-preset" data-color="#22c55e" style="background: #22c55e;"></div>
        <div class="color-preset" data-color="#10b981" style="background: #10b981;"></div>
        <div class="color-preset" data-color="#14b8a6" style="background: #14b8a6;"></div>
        <div class="color-preset" data-color="#06b6d4" style="background: #06b6d4;"></div>
        <div class="color-preset" data-color="#0ea5e9" style="background: #0ea5e9;"></div>
        <div class="color-preset" data-color="#3b82f6" style="background: #3b82f6;"></div>
        <div class="color-preset" data-color="#6366f1" style="background: #6366f1;"></div>
        <div class="color-preset" data-color="#8b5cf6" style="background: #8b5cf6;"></div>
        <div class="color-preset" data-color="#a855f7" style="background: #a855f7;"></div>
        <div class="color-preset" data-color="#d946ef" style="background: #d946ef;"></div>
        <div class="color-preset" data-color="#ec4899" style="background: #ec4899;"></div>
        <div class="color-preset" data-color="#f43f5e" style="background: #f43f5e;"></div>
        <div class="color-preset" data-color="#64748b" style="background: #64748b;"></div>
        <div class="color-preset" data-color="#6b7280" style="background: #6b7280;"></div>
        <div class="color-preset" data-color="#78716c" style="background: #78716c;"></div>
      </div>
      <div class="custom-color-section">
        <label class="custom-color-label">ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼</label>
        <input type="color" id="customColorInput" class="custom-color-input">
      </div>
      <div class="color-picker-actions">
        <button class="btn" style="background: var(--text-tertiary); color: white;" id="cancelColorBtn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn btn-primary" id="confirmColorBtn">æ±ºå®š</button>
      </div>
    </div>
  </div>

  <!-- æ—¥ä»˜é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="date-picker-modal" id="datePickerModal">
    <div class="date-picker-content">
      <h3 class="date-picker-title">æ—¥ä»˜ã‚’é¸æŠ</h3>
      
      <div class="date-picker-selectors">
        <div class="date-picker-group">
          <label class="date-picker-label">å¹´</label>
          <select id="yearSelect" class="date-picker-select"></select>
        </div>
        
        <div class="date-picker-group">
          <label class="date-picker-label">æœˆ</label>
          <select id="monthSelect" class="date-picker-select"></select>
        </div>
        
        <div class="date-picker-group">
          <label class="date-picker-label">æ—¥</label>
          <select id="daySelect" class="date-picker-select"></select>
        </div>
      </div>
      
      <div class="date-picker-weekday" id="weekdayDisplay"></div>
      
      <div class="date-picker-actions">
        <button class="btn" style="background: var(--text-tertiary); color: white;" id="cancelDateBtn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn btn-primary" id="confirmDateBtn">æ±ºå®š</button>
      </div>
    </div>
  </div>

  <!-- ==========================================================================
      ãƒ‡ãƒ¼ã‚¿åŸ‹ã‚è¾¼ã¿(JavaScriptç”¨)
      ========================================================================== -->
  <script id="events-data" type="application/json">{{ events|tojson|safe }}</script>
  <script id="month-key-data" type="text/plain">{{ month_key }}</script>
  <script id="goal-achieved-data" type="text/plain">{{ current_goal.achieved|tojson|safe }}</script>

  <script src="/static/js/calendar.js"></script>
  <script src="/static/js/calendar.js"></script>
  <script src="/static/js/mobile-ui.js"></script>

  <script>
  // Service Workerç™»éŒ²
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/static/js/service-worker.js')
        .then((registration) => {
          console.log('Service Workerç™»éŒ²æˆåŠŸ:', registration.scope);
        })
        .catch((error) => {
          console.log('Service Workerç™»éŒ²å¤±æ•—:', error);
        });
    });
  }
  </script>
</body>
</html>